<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Billing Structure | Hospital Control Center</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
body {
    background: linear-gradient(135deg, #f0fdf4, #ecfeff);
    color: #064e3b;
    font-family: 'Inter', system-ui, sans-serif;
}

/* Header */
.glass-header {
    background: rgba(6,78,59,0.08);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(6,78,59,0.15);
    padding: 18px 30px;
    margin-bottom: 30px;
}

/* Layout */
.page-wrapper { padding: 30px 35px; }

/* Cards */
.soft-card {
    background: #ffffff;
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 12px 35px rgba(6,78,59,0.12);
    margin-bottom: 30px;
}

/* Inputs */
.form-control {
    border-radius: 14px;
    padding: 12px 14px;
}

/* Buttons */
.btn-primary-soft {
    background: linear-gradient(135deg, #0d9488, #14b8a6);
    border: none;
    color: #fff;
    border-radius: 16px;
    padding: 10px 20px;
}
.btn-primary-soft:hover {
    background: linear-gradient(135deg, #0f766e, #0d9488);
}

.btn-update-soft {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border: none;
    color: #fff;
    border-radius: 14px;
}

.btn-danger-soft {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border: none;
    color: #fff;
    border-radius: 14px;
}

/* Table */
.table thead { background: #ecfeff; }
.table th { color: #065f46; }
.table-wrapper { max-height: 420px; overflow-y: auto; }

/* ===== MODAL STYLING ===== */
.modal-content {
    border-radius: 24px;
    background: linear-gradient(135deg, #ffffff, #f0fdf4);
    box-shadow: 0 15px 40px rgba(6,78,59,0.18);
    border: none;
}
.modal-title { color: #065f46; font-weight: 600; }
.modal-body .form-control {
    border-radius: 14px;
    border: 1px solid rgba(6,78,59,0.25);
}
.modal-body .form-control:focus {
    border-color: #14b8a6;
    box-shadow: 0 0 0 .15rem rgba(20,184,166,.25);
}
.btn-save-soft {
    background: linear-gradient(135deg, #0d9488, #14b8a6);
    border: none;
    color: #fff;
    border-radius: 16px;
    padding: 8px 22px;
}
.btn-save-soft:hover {
    background: linear-gradient(135deg, #0f766e, #0d9488);
}
</style>
</head>

<body>

<!-- Header -->
<div class="glass-header d-flex justify-content-between align-items-center">
    <h4 class="mb-0">üí≥ Billing Structure</h4>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">‚Üê Back</a>
</div>

<div class="page-wrapper">

<!-- Add Billing -->
<div class="soft-card">
<h5 class="mb-4">Add Billing Item</h5>
<form id="addBillingForm">
<div class="row g-3">
    <div class="col-md-3"><input class="form-control" placeholder="Treatment Name" required></div>
    <div class="col-md-3"><input type="number" class="form-control" placeholder="Treatment Cost" required></div>
    <div class="col-md-3"><input class="form-control" placeholder="Room Type" required></div>
    <div class="col-md-3"><input type="number" class="form-control" placeholder="Room Cost" required></div>
</div>
<div class="text-end mt-4">
    <button class="btn btn-primary-soft">Add Item</button>
</div>
</form>
</div>

<!-- Billing Table -->
<div class="soft-card">
<div class="d-flex justify-content-between mb-3">
    <h5>All Billing Items</h5>
    <input class="form-control w-25" id="billingFilter" placeholder="Search treatment">
</div>

<div class="table-wrapper">
<table class="table table-hover align-middle">
<thead>
<tr>
    <th>#</th>
    <th>Treatment</th>
    <th>Treatment Cost</th>
    <th>Room Type</th>
    <th>Room Cost</th>
    <th>Actions</th>
</tr>
</thead>
<tbody id="billingTable"></tbody>
</table>
</div>
</div>
</div>

<!-- UPDATE MODAL -->
<div class="modal fade" id="updateModal" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
    <h5 class="modal-title">Update Billing</h5>
    <button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
    <input type="hidden" id="uid">
    <label class="form-label">Treatment</label>
    <input class="form-control mb-2" id="uTreatment">
    <label class="form-label">Treatment Cost</label>
    <input type="number" class="form-control mb-2" id="uTreatmentCost">
    <label class="form-label">Room Type</label>
    <input class="form-control mb-2" id="uRoomType">
    <label class="form-label">Room Cost</label>
    <input type="number" class="form-control">
</div>
<div class="modal-footer">
    <button class="btn btn-save-soft" onclick="saveUpdate()">Save</button>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
let modal = new bootstrap.Modal(updateModal);

const fetchBilling = () => {
fetch("/billing/get_all")
.then(r=>r.json())
.then(d=>{
billingTable.innerHTML="";
d.forEach((b,i)=>{
billingTable.innerHTML+=`
<tr data-id="${b.id}">
<td>${i+1}</td>
<td>${b.treatment}</td>
<td>‚Çπ ${b.treatment_cost}</td>
<td>${b.room_type}</td>
<td>‚Çπ ${b.room_cost}</td>
<td>
<button class="btn btn-sm btn-update-soft me-1 updateBtn">Update</button>
<button class="btn btn-sm btn-danger-soft deleteBtn">Delete</button>
</td>
</tr>`;
});
});
};
fetchBilling();

addBillingForm.onsubmit=e=>{
e.preventDefault();
fetch("/billing/add",{method:"POST",headers:{"Content-Type":"application/json"},
body:JSON.stringify({
treatment:e.target[0].value,
treatment_cost:+e.target[1].value,
room_type:e.target[2].value,
room_cost:+e.target[3].value
})}).then(()=>{e.target.reset();fetchBilling();});
};

billingTable.onclick=e=>{
const tr=e.target.closest("tr"); if(!tr)return;
const id=tr.dataset.id;
if(e.target.classList.contains("deleteBtn")){
if(confirm("Delete item?"))
fetch(`/billing/delete/${id}`,{method:"DELETE"}).then(fetchBilling);
}
if(e.target.classList.contains("updateBtn")){
uid.value=id;
uTreatment.value=tr.cells[1].innerText;
uTreatmentCost.value=tr.cells[2].innerText.replace("‚Çπ","");
uRoomType.value=tr.cells[3].innerText;
document.querySelector("#updateModal input[type=number]:last-child").value=
tr.cells[4].innerText.replace("‚Çπ","");
modal.show();
}
};

function saveUpdate(){
fetch(`/billing/update/${uid.value}`,{
method:"PUT",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
treatment:uTreatment.value,
treatment_cost:+uTreatmentCost.value,
room_type:uRoomType.value,
room_cost:+document.querySelector("#updateModal input[type=number]:last-child").value
})
}).then(()=>{modal.hide();fetchBilling();});
}

billingFilter.onkeyup=()=>{
const f=billingFilter.value.toLowerCase();
document.querySelectorAll("#billingTable tr").forEach(r=>{
r.style.display=r.cells[1].innerText.toLowerCase().includes(f)?"":"none";
});
};
</script>
</body>
</html>


